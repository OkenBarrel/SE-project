{"ast":null,"code":"import React,{Component,useState,useEffect}from\"react\";import Box from'@mui/material/Box';import Tabs from'@mui/material/Tabs';import Tab from'@mui/material/Tab';import Card from'@mui/material/Card';import{useParams,useNavigate}from'react-router-dom';import ScoreComponent from\"./ScoreComponet\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CommentComponet=_ref=>{let{isbn}=_ref;const[value,setValue]=useState(0);const[relations,setRelations]=useState([]);const[comments,setComments]=useState([]);const handleChange=(event,newValue)=>{setValue(newValue);// setPasson(relations[newValue])\n// console.log(\"passon\"+passon)\n// console.log(relations[value][\"course\"]+\"-\"+relations[value][\"teacher\"]);\n};useEffect(()=>{getRelations();},[]);async function getRelations(){let response=await fetch(\"/api/get-useBook\"+\"?isbn=\"+isbn);if(!response.ok){console.log(\"get relations wrong!!\");return;}let data=await response.json();setRelations(data);// setIds(data?.usebook_id)\n// console.log(ids)\n// console.log(ids)\n}const getComment=async relationId=>{try{const response=await fetch(\"api/get-comment/\".concat(relationId));if(!response.ok){throw new Error('网络响应错误');}const data=await response.json();setComments(data);}catch(error){console.error('获取评论数据失败:',error);}};// 当relations或value变化时，获取新的评论数据\nuseEffect(()=>{if(relations.length>0&&relations[value]){const relationId=relations[value].id;// 假设每个relation对象都有一个id属性\ngetComment(relationId);}},[relations,value]);return/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',flexDirection:'row'},children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Tabs,{value:value,onChange:handleChange,variant:\"scrollable\",scrollButtons:\"auto\",children:relations.map(relation=>/*#__PURE__*/_jsx(Tab,{label:relation.course.course_name+\"-\"+relation.teacher}))})}),console.log(relations[value]),/*#__PURE__*/_jsx(ScoreComponent,{relation:relations[value]})]});};export default CommentComponet;","map":{"version":3,"names":["React","Component","useState","useEffect","Box","Tabs","Tab","Card","useParams","useNavigate","ScoreComponent","jsx","_jsx","jsxs","_jsxs","CommentComponet","_ref","isbn","value","setValue","relations","setRelations","comments","setComments","handleChange","event","newValue","getRelations","response","fetch","ok","console","log","data","json","getComment","relationId","concat","Error","error","length","id","sx","display","flexDirection","children","onChange","variant","scrollButtons","map","relation","label","course","course_name","teacher"],"sources":["D:/SE-project/textbook_genius/frontend/reactapp/src/components/CommentComponent.js"],"sourcesContent":["import React, { Component, useState,useEffect } from \"react\";\r\nimport Box from '@mui/material/Box';\r\nimport Tabs from '@mui/material/Tabs';\r\nimport Tab from '@mui/material/Tab';\r\nimport Card from '@mui/material/Card'\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport ScoreComponent from \"./ScoreComponet\";\r\n\r\nconst CommentComponet=({isbn})=>{\r\n\r\n    const [value,setValue]=useState(0);\r\n    const [relations,setRelations]=useState([]);\r\n    const [comments, setComments] = useState([]);\r\n\r\n\r\n    const handleChange = (event, newValue) => {\r\n        setValue(newValue);\r\n        // setPasson(relations[newValue])\r\n        // console.log(\"passon\"+passon)\r\n        // console.log(relations[value][\"course\"]+\"-\"+relations[value][\"teacher\"]);\r\n    };\r\n    useEffect(()=>{\r\n        getRelations();\r\n    },[]);\r\n\r\n    async function getRelations(){\r\n        let response=await fetch(\"/api/get-useBook\"+\"?isbn=\"+isbn);\r\n        if(!response.ok){\r\n            console.log(\"get relations wrong!!\");\r\n            return;\r\n        }\r\n        let data=await response.json();\r\n        setRelations(data);\r\n        // setIds(data?.usebook_id)\r\n        // console.log(ids)\r\n        // console.log(ids)\r\n    }\r\n  \r\n    const getComment = async (relationId) => {\r\n        try {\r\n            const response = await fetch(`api/get-comment/${relationId}`);\r\n            if (!response.ok) {\r\n                throw new Error('网络响应错误');\r\n            }\r\n            const data = await response.json();\r\n            setComments(data);\r\n        } catch (error) {\r\n            console.error('获取评论数据失败:', error);\r\n        }\r\n    };\r\n\r\n    // 当relations或value变化时，获取新的评论数据\r\n    useEffect(() => {\r\n        if (relations.length > 0 && relations[value]) {\r\n            const relationId = relations[value].id; // 假设每个relation对象都有一个id属性\r\n            getComment(relationId);\r\n        }\r\n    }, [relations, value]);\r\n    \r\n    return(\r\n        <Box sx={{display:'flex',flexDirection:'row'}}>\r\n            <Card>\r\n                <Tabs \r\n                    value={value} onChange={handleChange}\r\n                    variant=\"scrollable\" scrollButtons=\"auto\"\r\n                >\r\n                    {relations.map((relation)=>(\r\n                        <Tab label={relation.course.course_name+\"-\"+relation.teacher}></Tab>\r\n                    ))}\r\n                \r\n                </Tabs>\r\n            </Card>\r\n\r\n            {console.log(relations[value])}\r\n            <ScoreComponent relation={relations[value]}></ScoreComponent>\r\n        </Box>\r\n    )\r\n}\r\n\r\nexport default CommentComponet;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}