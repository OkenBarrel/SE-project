{"ast":null,"code":"import{Button,DialogContent,Grid,Typography,Box,Card,CardContent}from'@mui/material';import React,{useEffect,useState}from\"react\";import{useParams,useNavigate}from'react-router-dom';import{ContrastRounded,DeleteIcon}from'@mui/icons-material';import{styled}from'@mui/material/styles';import ThumbUpIcon from'@mui/icons-material/ThumbUp';import ThumbDownIcon from'@mui/icons-material/ThumbDown';import IconButton from'@mui/material/IconButton';import Tooltip from'@mui/material/Tooltip';import LinearProgress,{linearProgressClasses}from'@mui/material/LinearProgress';import{getCsrfToken,getCookie}from'./CSRFToken';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const ScoreComponent=_ref=>{let{relation}=_ref;const[course,setCourse]=useState(\"\");const[teacher,setTeacher]=useState(\"\");const[yes,setYes]=useState(false);const[no,setNo]=useState(false);const csrftoken=getCsrfToken();// const up=true,down=false;\n// const yesColor,noColor;\nuseEffect(()=>{var _relation$course;console.log(relation);setCourse(relation===null||relation===void 0?void 0:(_relation$course=relation.course)===null||_relation$course===void 0?void 0:_relation$course.course_name);setTeacher(relation===null||relation===void 0?void 0:relation.teacher);// if(up){\n//     setYes(true);\n// }\n// if(no){\n//     setNo(true)\n// }\n},[]);const handleRequest=async(url,method,body)=>{let requestOption={method:method,headers:{\"Content-Type\":\"application/json\",\"X-CSRFToken\":csrftoken},body:JSON.stringify(body)};let response=await fetch(url,requestOption);if(!response.ok){console.log(\"\".concat(method,\" request failed\"));return false;}return true;};async function handleYes(){console.log(\"yes\");if(no){return;}// const yesColor = yes&&!no ? \"#f44336\" : \"default\"; \nconst body={usebook:relation===null||relation===void 0?void 0:relation.id};if(yes){// 取消点赞\nconsole.log(\"yes\"+yes);const success=await handleRequest(\"/api/scoreUser\",\"DELETE\",body);// if (success) {\nsetYes(false);// }\n}else{// 进行点赞\nconsole.log(\"yes\"+yes);const success=await handleRequest(\"/api/scoreUser\",\"POST\",body);// if (success) {\nsetYes(true);// }\n}};async function handleNo(){// const noColor=no&&!yes? \"#0097a7\":\"default\";\nconsole.log('no');if(yes){return;}const body={usebook:relation===null||relation===void 0?void 0:relation.id};if(no){// 取消点踩\nconsole.log(\"no\"+no);const success=await handleRequest(\"/api/scoreUser\",\"DELETE\",body);setNo(false);}else{//进行点踩\nconsole.log(\"no\"+no);const success=await handleRequest(\"/api/scoreUser\",\"POST\",body);setNo(true);}};/*function handleNo(){\r\n        // const noColor=no&&!yes? \"#0097a7\":\"default\";\r\n        console.log('no');\r\n        if(yes){\r\n            return;\r\n        }\r\n\r\n        if(no){\r\n            // 取消点踩\r\n        }else{\r\n            //进行点踩\r\n        }\r\n\r\n    };*/const BorderLinearProgress=styled(LinearProgress)(_ref2=>{let{theme}=_ref2;return{height:30,//宽度\nborderRadius:5,[\"&.\".concat(linearProgressClasses.colorPrimary)]:{backgroundColor:theme.palette.mode==='light'?'#308fe8':'#308fe8'},[\"& .\".concat(linearProgressClasses.bar)]:{borderRadius:5,//圆头弧度 0直\nbackgroundColor:theme.palette.mode==='light'?'#f44334':'#308fe8'}};});return/*#__PURE__*/_jsx(Card,{sx:{width:200,height:200},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[\" \",course,\"-\",teacher]}),/*#__PURE__*/_jsx(BorderLinearProgress,{variant:\"determinate\",value:(relation===null||relation===void 0?void 0:relation.downvote_count)==0&&(relation===null||relation===void 0?void 0:relation.upvote_count)==0?0:(relation===null||relation===void 0?void 0:relation.upvote_count)/(relation===null||relation===void 0?void 0:relation.downvote_count)+(relation===null||relation===void 0?void 0:relation.upvote_count)}),/*#__PURE__*/_jsx(Tooltip,{title:\"\\u5B9E\\u7528\",children:/*#__PURE__*/_jsx(IconButton,{onClick:handleYes,children:/*#__PURE__*/_jsx(ThumbUpIcon,{variant:\"contained\",style:{color:yes?\"#f44336\":\"#353838\"}})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"\\u4E0D\\u5B9E\\u7528\",children:/*#__PURE__*/_jsx(IconButton,{onClick:handleNo,children:/*#__PURE__*/_jsx(ThumbDownIcon,{variant:\"contained\",style:{color:no?\"#0097a7\":\"#353838\"}})})})]})});};export default ScoreComponent;","map":{"version":3,"names":["Button","DialogContent","Grid","Typography","Box","Card","CardContent","React","useEffect","useState","useParams","useNavigate","ContrastRounded","DeleteIcon","styled","ThumbUpIcon","ThumbDownIcon","IconButton","Tooltip","LinearProgress","linearProgressClasses","getCsrfToken","getCookie","jsxs","_jsxs","jsx","_jsx","ScoreComponent","_ref","relation","course","setCourse","teacher","setTeacher","yes","setYes","no","setNo","csrftoken","_relation$course","console","log","course_name","handleRequest","url","method","body","requestOption","headers","JSON","stringify","response","fetch","ok","concat","handleYes","usebook","id","success","handleNo","BorderLinearProgress","_ref2","theme","height","borderRadius","colorPrimary","backgroundColor","palette","mode","bar","sx","width","children","variant","value","downvote_count","upvote_count","title","onClick","style","color"],"sources":["D:/projects/SE-project/textbook_genius/frontend/reactapp/src/components/ScoreComponet.js"],"sourcesContent":["import {Button,DialogContent,Grid,Typography,Box,Card, CardContent} from '@mui/material';\r\nimport React,{useEffect,useState} from \"react\";\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport {ContrastRounded, DeleteIcon} from'@mui/icons-material';\r\nimport { styled } from '@mui/material/styles';\r\nimport ThumbUpIcon from '@mui/icons-material/ThumbUp';\r\nimport ThumbDownIcon from '@mui/icons-material/ThumbDown';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport Tooltip from '@mui/material/Tooltip';\r\nimport LinearProgress, { linearProgressClasses } from '@mui/material/LinearProgress';\r\n\r\nimport { getCsrfToken,getCookie } from './CSRFToken';\r\n\r\nconst ScoreComponent=({relation})=>{\r\n    const [course,setCourse]=useState(\"\");\r\n    const [teacher,setTeacher]=useState(\"\");\r\n    const [yes,setYes]=useState(false);\r\n    const [no,setNo]=useState(false);\r\n\r\n    const csrftoken=getCsrfToken();\r\n    // const up=true,down=false;\r\n    // const yesColor,noColor;\r\n\r\n\r\n    useEffect(()=>{\r\n        console.log(relation);\r\n        setCourse(relation?.course?.course_name);\r\n        setTeacher(relation?.teacher);\r\n        // if(up){\r\n        //     setYes(true);\r\n        // }\r\n        // if(no){\r\n        //     setNo(true)\r\n        // }\r\n    },[])\r\n\r\n    const handleRequest = async (url, method, body) => {\r\n        let requestOption = {\r\n            method: method,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"X-CSRFToken\": csrftoken\r\n            },\r\n            body: JSON.stringify(body)\r\n        };\r\n        let response = await fetch(url, requestOption);\r\n        if (!response.ok) {\r\n            console.log(`${method} request failed`);\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    async function handleYes(){\r\n        console.log(\"yes\");\r\n        if(no){\r\n            return;\r\n        }\r\n        // const yesColor = yes&&!no ? \"#f44336\" : \"default\"; \r\n        const body = { \r\n            usebook: relation?.id\r\n        };\r\n        if (yes) {\r\n            // 取消点赞\r\n            console.log(\"yes\"+yes);\r\n            const success = await handleRequest(\"/api/scoreUser\", \"DELETE\", body);\r\n            // if (success) {\r\n                setYes(false);\r\n            // }\r\n        } else {\r\n            // 进行点赞\r\n            console.log(\"yes\"+yes);\r\n            const success = await handleRequest(\"/api/scoreUser\", \"POST\", body);\r\n            // if (success) {\r\n                setYes(true);\r\n            // }\r\n        }\r\n\r\n    };\r\n\r\n    async function handleNo(){\r\n        // const noColor=no&&!yes? \"#0097a7\":\"default\";\r\n        console.log('no');\r\n        if(yes){\r\n           return;\r\n        }\r\n        const body = { \r\n            usebook: relation?.id\r\n        };\r\n        if(no){\r\n            // 取消点踩\r\n            console.log(\"no\"+no);\r\n            const success = await handleRequest(\"/api/scoreUser\", \"DELETE\", body);\r\n                setNo(false);\r\n        }else{\r\n            //进行点踩\r\n            console.log(\"no\"+no);\r\n            const success = await handleRequest(\"/api/scoreUser\", \"POST\", body);\r\n                setNo(true);\r\n        }\r\n\r\n    };\r\n\r\n    /*function handleNo(){\r\n        // const noColor=no&&!yes? \"#0097a7\":\"default\";\r\n        console.log('no');\r\n        if(yes){\r\n            return;\r\n        }\r\n\r\n        if(no){\r\n            // 取消点踩\r\n        }else{\r\n            //进行点踩\r\n        }\r\n\r\n    };*/\r\n    const BorderLinearProgress = styled(LinearProgress)(({ theme }) => ({\r\n        height: 30,//宽度\r\n        borderRadius: 5,\r\n        [`&.${linearProgressClasses.colorPrimary}`]: {\r\n          backgroundColor: theme.palette.mode === 'light' ? '#308fe8' : '#308fe8',\r\n        },\r\n        [`& .${linearProgressClasses.bar}`]: {\r\n          borderRadius: 5,//圆头弧度 0直\r\n          backgroundColor: theme.palette.mode === 'light' ? '#f44334' : '#308fe8',\r\n        },\r\n      }));\r\n\r\n    return(\r\n        \r\n        <Card sx={{width:200,height:200}}>\r\n            <CardContent>\r\n                {/* {console.log(course)} */}\r\n                <Typography variant=\"h6\"> {course}-{teacher}</Typography>\r\n                <BorderLinearProgress variant=\"determinate\" value={relation?.downvote_count==0&&relation?.upvote_count==0 ? 0:relation?.upvote_count/relation?.downvote_count+relation?.upvote_count} />\r\n                <Tooltip title=\"实用\">\r\n                    <IconButton onClick={handleYes}>\r\n                        <ThumbUpIcon variant=\"contained\" style={{ color: yes ? \"#f44336\" : \"#353838\" }}/>\r\n                    </IconButton>\r\n                </Tooltip>\r\n                <Tooltip title=\"不实用\">\r\n                    <IconButton onClick={handleNo}>\r\n                        <ThumbDownIcon variant=\"contained\" style={{ color: no ? \"#0097a7\" : \"#353838\" }}/>\r\n                    </IconButton>\r\n                </Tooltip>\r\n                \r\n            </CardContent>\r\n        </Card>\r\n    );\r\n\r\n}\r\nexport default ScoreComponent;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}